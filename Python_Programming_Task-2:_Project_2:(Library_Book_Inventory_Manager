import json
import datetime

DATA_FILE = 'library_inventory.json'

class Book:
    def __init__(self, title, author):
        self.title = title
        self.author = author
        self.issued = False

    def to_dict(self):
        return {
            'title': self.title,
            'author': self.author,
            'issued': self.issued
        }

    @staticmethod
    def from_dict(data):
        book = Book(data['title'], data['author'])
        book.issued = data['issued']
        return book


class Library:
    def __init__(self):
        self.books = {}  # key: title.lower(), value: Book object
        self.load_books()

    def load_books(self):
        try:
            with open(DATA_FILE, 'r') as f:
                data = json.load(f)
                for book_data in data:
                    book = Book.from_dict(book_data)
                    self.books[book.title.lower()] = book
        except FileNotFoundError:
            print("No existing data found. Starting fresh.")

    def save_books(self):
        with open(DATA_FILE, 'w') as f:
            json.dump([book.to_dict() for book in self.books.values()], f, indent=4)

    def add_book(self):
        title = input("Enter book title: ").strip()
        author = input("Enter author name: ").strip()
        key = title.lower()
        if key in self.books:
            print("Book already exists.")
        else:
            self.books[key] = Book(title, author)
            self.save_books()
            print("Book added successfully.")

    def search_books(self):
        query = input("Search by title or author: ").strip().lower()
        results = [book for book in self.books.values()
                   if query in book.title.lower() or query in book.author.lower()]
        if results:
            print("\nSearch Results:")
            for book in results:
                status = "Issued" if book.issued else "Available"
                print(f"- {book.title} by {book.author} [{status}]")
        else:
            print("No matching books found.")

    def issue_book(self):
        title = input("Enter title to issue: ").strip().lower()
        book = self.books.get(title)
        if book:
            if book.issued:
                print("Book is already issued.")
            else:
                book.issued = True
                self.save_books()
                print("Book issued successfully.")
        else:
            print("Book not found.")

    def return_book(self):
        title = input("Enter title to return: ").strip().lower()
        book = self.books.get(title)
        if book:
            if not book.issued:
                print("Book was not issued.")
            else:
                book.issued = False
                self.save_books()
                print("Book returned successfully.")
        else:
            print("Book not found.")

    def report(self):
        total = len(self.books)
        issued = sum(1 for book in self.books.values() if book.issued)
        print(f"\nðŸ“Š Library Report:")
        print(f"- Total books: {total}")
        print(f"- Issued books: {issued}")
        print(f"- Available books: {total - issued}")


def main():
    library = Library()
    while True:
        print("\n===== Library Inventory Manager =====")
        print("1. Add Book")
        print("2. Search Book")
        print("3. Issue Book")
        print("4. Return Book")
        print("5. View Report")
        print("6. Quit")

        try:
            choice = int(input("Choose an option: "))
        except ValueError:
            print("Please enter a valid number.")
            continue

        if choice == 1:
            library.add_book()
        elif choice == 2:
            library.search_books()
        elif choice == 3:
            library.issue_book()
        elif choice == 4:
            library.return_book()
        elif choice == 5:
            library.report()
        elif choice == 6:
            print("Goodbye! Library data saved.")
            break
        else:
            print("Invalid choice. Try again.")


if __name__ == '__main__':
    main()
